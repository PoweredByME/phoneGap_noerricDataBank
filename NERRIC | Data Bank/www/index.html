
<!DOCTYPE html>

<html>

<head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width" />
        <!-- This is a wide open CSP declaration. To lock this down for production, see below. -->
        
        <!-- Chrome, Firefox and Opera -->
            <meta name="theme-color" content="#301934">
            <!-- Windows Phone -->
            <meta name="msapplication-navbutton-color" content="#301934">
            <!-- iOS Safari -->
            <meta name="apple-mobile-web-app-capable" content="yes">
            <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
        <!-- Good default declaration:
        * gap: is required only on iOS (when using UIWebView) and is needed for JS->native communication
        * https://ssl.gstatic.com is required only on Android and is needed for TalkBack to function properly
        * Disables use of eval() and inline scripts in order to mitigate risk of XSS vulnerabilities. To change this:
            * Enable inline JS: add 'unsafe-inline' to default-src
            * Enable eval(): add 'unsafe-eval' to default-src
        * Create your own at http://cspisawesome.com
        -->
        <!-- <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: 'unsafe-inline' https://ssl.gstatic.com; style-src 'self' 'unsafe-inline'; media-src *" /> -->
        <link rel="stylesheet" type="text/css" href="css/index.css" />
        <link rel="stylesheet" type="text/css" href="theWebAPI/materialize/css/materialize.min.css">
        <title>NOERRIC | Shoe Survey</title>
    
    </head>

    <body class="white the-body" style="padding:0px;margin:0px">
        
        <div class="card green white-text" style="border-radius:0px !important;position:fixed;display:flex;align-items:center; padding:8px !important;height:56px;width:100vw; margin:0px; !important; padding-left:16px !important">
            <h5>NOERRIC | <span style="font-size:12px">SHOE SURVEY</span></h5>
        </div>
        
        <div class="valign-wrapper" style="height:100vh; width:100vw">
            <div class="center" style="width:100vw">
                
                <div>
                    <p class="center" style="padding:10px;">
                        We are trying to collect images of SHOES in order to train our Machine Learning Algorithm.
                        <br><br>Your contribution is much appreciated. Thanks.
                    </p>
                    <button class="btn green lighten-4 black-text" id="but-sel">SELECT IMAGES FROM GALLARY</button><br><br>
                    <button class="btn green darken-1 white-text" id="but-take">TAKE IMAGE FROM CAMERA</button>
                    <p class="center" style="padding:20px;">Just take the image of your shoes and we will take care of the rest.</p>
                    <div style="margin-bottom:10px;">
                        <p class="uploaded-image-count chip hide">
                            
                        </p>
                    </div>
                    <div class="preloader-wrapper small active hide image-loader">
                        <div class="spinner-layer spinner-green-only">
                        <div class="circle-clipper left">
                        <div class="circle"></div>
                        </div><div class="gap-patch">
                        <div class="circle"></div>
                        </div><div class="circle-clipper right">
                        <div class="circle"></div>
                        </div>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
        
        <div class="center" style="position:fixed; bottom:0; background:#f0f0f0; width:100vw;padding:0px;font-weight:300;font-size:10px">
            <p>Developed by Saad Ahmad</p>
        </div>
        
        <script type="text/javascript" src="cordova.js"></script>
        <script type="text/javascript" src="theWebAPI/jQuery.min.js"></script>
        <script type="text/javascript" src="theWebAPI/materialize/js/materialize.min.js"></script>
        <script type="text/javascript" src="js/index.js"></script>
        <script type="text/javascript">
            var serverName = "noerric.com/noerric_image_acq/server.php";
var pictureSource, destinationType;
var app = {

    initialize: function() {
        this.bindEvents();
    },
    // Bind Event Listeners
    //
    // Bind any events that are required on startup. Common events are:
    // 'load', 'deviceready', 'offline', and 'online'.
    bindEvents: function() {
        document.addEventListener('deviceready', this.onDeviceReady, false);
    },
    // deviceready Event Handler
    //
    // The scope of 'this' is the event. In order to call the 'receivedEvent'
    // function, we must explicitly call 'app.receivedEvent(...);'
    onDeviceReady: function() {
        readyButton();
        console.log ("hel");
    },
    
};


function readyButton(){
    
    $('#but-sel').click(function(){
        window.imagePicker.getPictures(function(results) {
		  for (var i = 0; i < results.length; i++) {
                sentDataToServer(results[i]);
		  }
        }, function (error) {
                console.log(error);
		      alert("Error : " + error);
	       }, {quality: 20});   
    }); 
    
    
    $('#but-take').click(function(){   
        navigator.camera.getPicture(onSuccess, onFail, { quality: 20,
            destinationType: Camera.DestinationType.FILE_URL
        });
    });
}


function onSuccess(imageURI) {
    sentDataToServer(imageURI);                
}
function onFail(message) {
    alert('Failed because: ' + message);
}

var imageUploadCount = 0;
var totalImageUploadCount = 0;

function sentDataToServer(imageURI) {
    totalImageUploadCount++;
    showImageUploadCount();
    var options = new FileUploadOptions();
    options.fileKey="file";
    options.fileName=imageURI.substr(imageURI.lastIndexOf('/')+1);
    options.mimeType="image/jpeg";
    var params = new Object();
    params.value1 = "test";
    params.value2 = "param"; 
    options.params = params;
    options.chunkedMode = false;
    var ft = new FileTransfer();
    
    ft.upload(imageURI, "http://"+serverName, win, fail, options);
}

function win(r) {
    imageUploadCount++;
    showImageUploadCount();
    console.log("Code = " + r.responseCode);
    console.log("Response = " + r.response);
    console.log("Sent = " + r.bytesSent);
}
 
function fail(error) {
    imageUploadCount++;
    showImageUploadCount();
    alert("Error : The Image could not be uploaded. Chack your internet connection");
    console.log(error);
}

function showImageUploadCount(){
    var s = "Images Uploaded : " + imageUploadCount + "/" + totalImageUploadCount;
    $(".uploaded-image-count").empty();
    $(".uploaded-image-count").append(s);
    if(imageUploadCount === totalImageUploadCount){
        $(".uploaded-image-count").addClass("hide");
        $(".image-loader").addClass("hide");
        imageUploadCount = 0;
        totalImageUploadCount = 0;
    }else{
        $(".uploaded-image-count").removeClass("hide");
        $(".image-loader").removeClass("hide");
    }
}


function windowOnLoad(){
    app.initialize();
}
            
           window.onload = windowOnLoad;
        </script>
    </body>

</html>


